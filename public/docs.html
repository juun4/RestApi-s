<!doctype html>
<html lang="id">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>JunnAPIs • Docs</title>
  <link rel="preconnect" href="https://fonts.googleapis.com"/>
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin/>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800&display=swap" rel="stylesheet"/>
  <style>
    :root{
      --bg:#0b1020; --surface:#0e1430; --card:#111736; --muted:#9aa4c7; --text:#e6ecff;
      --line:#1b2247; --pill:#2a3471; --acc:#7aa2ff; --acc2:#4ad295;
    }
    *{box-sizing:border-box}
    body{margin:0;font-family:Inter,system-ui,Segoe UI,Arial;background:var(--bg);color:var(--text)}
    a{text-decoration:none;color:inherit;word-break:break-all}
    .wrap{max-width:min(900px,100vw - 32px);margin:0 auto;padding:24px}

    header{display:flex;align-items:center;justify-content:space-between;gap:16px;flex-wrap:wrap;margin-bottom:20px}
    .brand{display:flex;align-items:center;gap:12px}
    .brand h1{font-size:22px;margin:0}
    .tag{color:var(--muted);font-size:14px}
    .btn{display:inline-flex;align-items:center;gap:8px;background:linear-gradient(90deg,var(--acc),var(--acc2));
      color:#04102a;padding:8px 12px;border-radius:10px;font-weight:700}

    .tabs{display:flex;gap:8px;overflow-x:auto;padding-bottom:10px;border-bottom:1px solid var(--line);scrollbar-width:none;margin-bottom:18px}
    .tabs::-webkit-scrollbar{display:none}
    .tab{padding:8px 14px;border-radius:10px;background:#141a3b;color:var(--muted);font-weight:600;cursor:pointer;flex-shrink:0;white-space:nowrap}
    .tab.active{background:linear-gradient(90deg,var(--acc),var(--acc2));color:#04102a}

    .section{background:var(--surface);border:1px solid var(--line);border-radius:16px;padding:16px;box-shadow:0 10px 30px rgba(0,0,0,.18)}
    .grid{display:grid;gap:16px;grid-template-columns:1fr;}
    .item{background:var(--card);border:1px solid var(--line);border-radius:12px;padding:14px;display:flex;flex-direction:column;gap:10px}
    .title{font-weight:700;margin:0}
    .desc{color:var(--muted);font-size:14px;margin:0}

    .meta{display:flex;flex-direction:column;gap:6px}
    .pill{display:flex;align-items:flex-start;gap:6px;padding:6px 8px;border:1px solid var(--pill);
      border-radius:999px;color:#c6d2ff;font-size:12px;background:rgba(255,255,255,0.02);word-break:break-word}
    .pill b{color:#cfe1ff;white-space:nowrap;margin-right:4px}
    .pill .example-url{flex:1;white-space:normal;word-break:break-word;overflow-wrap:anywhere;line-height:1.5}

    .actions{display:flex;gap:8px;flex-wrap:wrap}
    .open{display:inline-flex;align-items:center;justify-content:center;background:linear-gradient(90deg,var(--acc),var(--acc2));
      color:#04102a;padding:9px 12px;border-radius:10px;font-weight:800;margin-top:auto;width:max-content}
    .codebtn{display:inline-flex;align-items:center;justify-content:center;background:#141a3b;border:1px solid var(--line);
      color:#cfe1ff;padding:9px 12px;border-radius:10px;font-weight:800;margin-top:auto}

    footer{margin-top:28px;color:var(--muted);font-size:13px;text-align:center}

    /* ===== Modal Runner ===== */
    .backdrop{position:fixed;inset:0;background:rgba(0,0,0,.55);display:none;align-items:center;justify-content:center;padding:16px;z-index:50}
    .backdrop.show{display:flex}
    .modal{width:min(980px,100%);max-height:92vh;background:#0f1736;border:1px solid var(--line);border-radius:16px;box-shadow:0 30px 80px rgba(0,0,0,.5);display:flex;flex-direction:column}
    .modal-hd{display:flex;align-items:center;justify-content:space-between;gap:10px;padding:14px 16px;border-bottom:1px solid var(--line)}
    .modal-tt{font-weight:800}
    .x{border:1px solid var(--line);background:#101a3c;color:#cfe1ff;border-radius:10px;padding:8px 10px;cursor:pointer}
    .modal-bd{padding:14px 16px;overflow:auto}

    .kv{display:grid;gap:10px;grid-template-columns:repeat(auto-fit,minmax(180px,1fr))}
    .kv .field{display:flex;flex-direction:column;gap:6px}
    .kv input{padding:10px 12px;border-radius:10px;border:1px solid var(--line);background:#0e1836;color:#cfe1ff}

    .rtabs{display:flex;gap:8px;flex-wrap:wrap;margin:10px 0}
    .rtab{padding:8px 10px;border-radius:10px;background:#101c44;border:1px solid #213072;color:#cfe1ff;font-weight:800;cursor:pointer}
    .rtab.active{background:linear-gradient(90deg,var(--acc),var(--acc2));color:#051028;border-color:transparent}

    .codebox{position:relative;background:#0b1432;border:1px solid #1c2656;border-radius:12px;padding:12px;overflow:auto;max-height:320px}
    pre{margin:0;white-space:pre}
    .copy{position:absolute;top:8px;right:8px;font-size:12px;background:#0e1736;border:1px solid #213072;color:#cfe1ff;border-radius:8px;padding:6px 8px;cursor:pointer}
    .run{display:flex;gap:10px;flex-wrap:wrap;margin-top:10px}
    .btn-run{padding:12px 14px;border-radius:12px;background:linear-gradient(90deg,var(--acc),var(--acc2));color:#051028;font-weight:800;border:none;cursor:pointer}
    .btn-reset{padding:12px 14px;border-radius:12px;background:#10193c;border:1px solid #1b2350;color:#cfe1ff;font-weight:800;cursor:pointer}
    .status{display:inline-flex;gap:6px;align-items:center;padding:6px 10px;border-radius:999px;background:#0e1838;border:1px solid #25356f;color:#9fb2ff;font-weight:800}
    .resp{background:#0b1432;border:1px solid #1c2656;border-radius:12px;padding:12px;overflow:auto;min-height:120px;max-height:420px}
    .mono{font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;color:#cfe1ff}
  </style>
</head>
<body>
  <div class="wrap">
    <header>
      <div class="brand">
        <svg width="34" height="34" viewBox="0 0 24 24" fill="none"><path d="M5 12h14M12 5v14" stroke="#7aa2ff" stroke-width="2" stroke-linecap="round"/></svg>
        <div>
          <h1 id="siteName">JunnAPIs</h1>
          <div class="tag">Free & Simple REST Endpoints — <b>Docs</b></div>
        </div>
      </div>
      <div style="display:flex;gap:10px;flex-wrap:wrap">
        <a id="repoLink" class="btn" target="_blank">GitHub</a>
        <a class="btn" href="/">Home</a>
      </div>
    </header>

    <div id="tabs" class="tabs"></div>
    <div id="content"></div>

    <footer>Made by <b id="creator">juun4</b></footer>
  </div>

  <!-- Runner Modal -->
  <div id="runner" class="backdrop" aria-hidden="true">
    <div class="modal">
      <div class="modal-hd">
        <div class="modal-tt" id="rTitle">Example Code</div>
        <button class="x" id="rClose">Close</button>
      </div>
      <div class="modal-bd">
        <div class="kv" style="margin-bottom:10px">
          <div class="field">
            <label class="tag">Global API Key (tersimpan lokal)</label>
            <input id="rGlobalKey" placeholder="Masukkan API key (opsional)"/>
          </div>
        </div>

        <div class="tag" style="display:block;margin:6px 0 8px">Parameter</div>
        <div id="rParams" class="kv"></div>

        <div class="rtabs" id="rTabs">
          <button class="rtab active" data-mode="cURL">cURL</button>
          <button class="rtab" data-mode="CJS">Javascript (CJS)</button>
          <button class="rtab" data-mode="ESM">Javascript (ESM)</button>
        </div>

        <div class="codebox">
          <button class="copy" id="rCopy">Copy</button>
          <pre id="rCode" class="mono"></pre>
        </div>

        <div class="run">
          <button id="rExec" class="btn-run">Execute</button>
          <button id="rReset" class="btn-reset">Reset</button>
          <span id="rStatus" class="status">waiting</span>
        </div>
        <div id="rResp" class="resp mono" style="margin-top:10px">{\n  "status":"waiting",\n  "message":"No response yet"\n}</div>
      </div>
    </div>
  </div>

  <script>
  // ---------- helpers ----------
  const $ = (q)=>document.querySelector(q);
  function parseParamsFromPath(path){
    const q = (path.split('?')[1]||'').trim();
    if(!q) return [];
    return q.split('&').filter(Boolean).map(kv=>{
      const [k,v] = kv.split('=');
      return {key:k, value: decodeURIComponent(v||'')};
    });
  }
  function buildURL(basePath, fields){
    const origin = location.origin;
    const root = basePath.split('?')[0];
    const qp = new URLSearchParams();
    fields.forEach(f=> qp.set(f.dataset.param, f.value));
    return `${origin}${root}?${qp.toString()}`;
  }
  function samples(url){
    return {
      cURL: `curl -s "${url}" \\\n  -H "Accept: application/json"`,
      CJS: `const fetch = require('node-fetch');\n\nasync function main(){\n  const res = await fetch("${url}", { headers: { 'Accept':'application/json' } });\n  const json = await res.json();\n  console.log(json);\n}\nmain().catch(console.error);`,
      ESM: `async function main(){\n  const res = await fetch("${url}", { headers: { 'Accept':'application/json' } });\n  const json = await res.json();\n  console.log(json);\n}\nmain().catch(console.error);`
    };
  }
  function setRawQuery(href, example){
    // dipakai untuk "Open Endpoint" agar url= tidak di-encode
    if (href.includes('url=') && href.includes('apikey=')) {
      const [base, q] = href.split('?');
      const params = new URLSearchParams(q);
      if (params.has('url')) params.set('url', example || '');
      return base + '?' + params.toString()
        .replace(/%3A/g, ':').replace(/%2F/g, '/')
        .replace(/%3F/g, '?').replace(/%3D/g, '=').replace(/%26/g, '&');
    } else if (href.endsWith('=') && example) {
      return href + example;
    }
    return href;
  }

  // ---------- main docs ----------
  let CFG=null;
  let CURRENT=null; // {cat,item}
  const runner = $('#runner'), rTitle = $('#rTitle'), rParams = $('#rParams');
  const rTabs = $('#rTabs'), rCode = $('#rCode'), rCopy = $('#rCopy');
  const rExec = $('#rExec'), rReset = $('#rReset'), rStatus = $('#rStatus'), rResp = $('#rResp');
  const rGlobalKey = $('#rGlobalKey');
  let R_MODE='cURL';

  rGlobalKey.value = localStorage.getItem('JUNN_DOCS_KEY') || '';
  rGlobalKey.addEventListener('input', ()=>localStorage.setItem('JUNN_DOCS_KEY', rGlobalKey.value.trim()));
  $('#rClose').addEventListener('click', ()=>runner.classList.remove('show'));
  rTabs.addEventListener('click', (e)=>{
    const b = e.target.closest('.rtab'); if(!b) return;
    rTabs.querySelectorAll('.rtab').forEach(t=>t.classList.remove('active'));
    b.classList.add('active'); R_MODE=b.dataset.mode;
    if(CURRENT) updateRunnerCode();
  });
  rCopy.addEventListener('click', async ()=>{
    await navigator.clipboard.writeText(rCode.textContent||''); rCopy.textContent='Copied!'; setTimeout(()=>rCopy.textContent='Copy',800);
  });
  rExec.addEventListener('click', async ()=>{
    if(!CURRENT) return;
    const fields = [...rParams.querySelectorAll('[data-param]')];
    const url = buildURL(CURRENT.item.path, fields);
    rStatus.textContent='fetching…'; rResp.textContent='';
    try{
      const res = await fetch(url, { headers: { 'Accept':'application/json' } });
      const text = await res.text();
      try{ rResp.textContent = JSON.stringify(JSON.parse(text), null, 2); }
      catch{ rResp.textContent = text; }
      rStatus.textContent = `${res.status} ${res.statusText}`;
    }catch(err){
      rStatus.textContent='error'; rResp.textContent=String(err);
    }
  });
  rReset.addEventListener('click', ()=>{ if(CURRENT){ fillParamFields(CURRENT.item); updateRunnerCode(); rStatus.textContent='ready'; rResp.textContent='{\n  "status":"waiting",\n  "message":"No response yet"\n}'; } });

  function fillParamFields(item){
    const params = parseParamsFromPath(item.path||'');
    params.forEach(p=>{
      if(p.key.toLowerCase()==='apikey' && !p.value) p.value = rGlobalKey.value || '';
      if(!p.value && item.example && p.key.toLowerCase()==='url') p.value = item.example;
    });
    rParams.innerHTML = params.map(p=>`
      <div class="field">
        <label class="tag">${p.key}</label>
        <input data-param="${p.key}" value="${(p.value||'').replace(/"/g,'&quot;')}" placeholder="${p.key} value"/>
      </div>`).join('') || `<div class="tag">Endpoint ini tidak memiliki parameter query.</div>`;
  }
  function updateRunnerCode(){
    const fields = [...rParams.querySelectorAll('[data-param]')];
    const url = buildURL(CURRENT.item.path, fields);
    const s = samples(url); rCode.textContent = s[R_MODE];
  }
  function openRunner(cat,item){
    CURRENT = {cat,item};
    rTitle.textContent = `${item.title || 'Endpoint'} — ${cat.title || ''}`;
    fillParamFields(item); updateRunnerCode();
    rStatus.textContent='ready'; rResp.textContent='{\n  "status":"waiting",\n  "message":"No response yet"\n}';
    runner.classList.add('show');
  }

  async function main(){
    const res = await fetch('/src/web-set.json',{cache:'no-store'});
    const cfg = await res.json();
    CFG = cfg;

    document.getElementById('siteName').textContent = cfg?.branding?.siteName ?? 'JunnAPIs';
    document.getElementById('creator').textContent  = cfg?.apiSettings?.creator ?? 'unknown';
    document.getElementById('repoLink').href = cfg?.branding?.repo || '#';

    const cats = cfg.categories || [];
    const tabs = document.getElementById('tabs');
    const content = document.getElementById('content');

    cats.forEach((cat,i)=>{
      const tab=document.createElement('div');
      tab.className='tab'+(i===0?' active':'');
      tab.textContent=cat.title||'Category';
      tab.addEventListener('click',()=>{
        document.querySelectorAll('.tab').forEach(t=>t.classList.remove('active'));
        tab.classList.add('active'); render(cat);
      });
      tabs.appendChild(tab);
    });
    if(cats[0]) render(cats[0]);

    function render(cat){
      content.innerHTML='';
      const section=document.createElement('section'); section.className='section';
      const grid=document.createElement('div'); grid.className='grid';

      (cat.items||[]).forEach(it=>{
        const card=document.createElement('div'); card.className='item';
        const t=document.createElement('div'); t.className='title'; t.textContent=it.title||'Untitled';
        const d=document.createElement('p'); d.className='desc'; d.textContent=it.desc||'';
        card.appendChild(t); card.appendChild(d);

        const meta=document.createElement('div'); meta.className='meta';
        const key=document.createElement('div'); key.className='pill';
        key.textContent=(it.requireKey ?? cfg.apiSettings?.defaultRequireKey) ? 'Requires API Key' : 'No Key';
        meta.appendChild(key);

        if(it.example){
          const ex=document.createElement('div'); ex.className='pill';
          const label=document.createElement('b'); label.textContent='Example:';
          const url=document.createElement('span'); url.className='example-url'; url.textContent=it.example;
          ex.appendChild(label); ex.appendChild(url); meta.appendChild(ex);
        }
        card.appendChild(meta);

        // actions
        const actions = document.createElement('div'); actions.className='actions';

        if(it.path){
          const go=document.createElement('a'); go.className='open'; go.textContent='Open Endpoint';
          let href = (it.path||'').trim();
          href = setRawQuery(href, it.example);
          go.href = href; go.target = '_blank';
          actions.appendChild(go);

          const codeBtn=document.createElement('button'); codeBtn.type='button'; codeBtn.className='codebtn'; codeBtn.textContent='Example Code';
          codeBtn.addEventListener('click', ()=>openRunner(cat,it));
          actions.appendChild(codeBtn);
        }
        card.appendChild(actions);

        grid.appendChild(card);
      });

      section.appendChild(grid); content.appendChild(section);
    }
  }
  main().catch(e=>{
    document.getElementById('content').innerHTML=`<div class='section'><div class='item'>Error: ${e.message}</div></div>`;
  });
  </script>
</body>
  </html>
